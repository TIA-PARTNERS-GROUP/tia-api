## TIA API: Development and Testing Guide
---

### Prerequisites

Before you begin, make sure you have the following tools installed

* **[Go](https://go.dev/doc/install)** (v1.20+)
* **[Docker](https://docs.docker.com/engine/install/)**
* **[Docker Compose](https://docs.docker.com/compose/install/)**

### Initial Setup

#### 1. Create your .env file

```bash
# .env
DATABASE_URL="root:tia-dev-password@tcp(127.0.0.1:3306)/tia-dev?charset=utf8mb4&parseTime=True&loc=Local"
JWT_SECRET="dbbf432d3d0205b3fdfb590cd6bd5dc2cb263e584b9cd403d06be3efade76e72"
```

#### 2. Running the application

Docker Compose
```bash
docker-compose up --build
```

Local Development
```bash
./scripts/run.sh
```

#### 3. Install Essential Go Tools

Install required tools for visualization, documentation, and code generation using `go install`:

```bash
# Visualization Tools
go install [github.com/roblaszczak/vgt@latest](https://github.com/roblaszczak/vgt@latest)
go install [github.com/goptics/vizb@latest](https://github.com/goptics/vizb@latest)

# Documentation Tools
go install golang.org/x/tools/cmd/godoc@latest
go install [github.com/princjef/gomarkdoc/cmd/gomarkdoc@latest](https://github.com/princjef/gomarkdoc/cmd/gomarkdoc@latest)
go install [github.com/swaggo/swag/cmd/swag@latest](https://github.com/swaggo/swag/cmd/swag@latest)
```

#### 4. Configure Database for Integration Tests

All integration tests rely on a running MySQL database defined in your `docker-compose.yml`.

To start the test database:

```bash
# Starts the MySQL database (mariadb) container in the background
docker-compose up -d database
```

### Testing and Code Quality

Test scripts are located in the `scripts/tests` directory.

#### 1. Running Unit Tests

Unit tests validate isolated package logic (files in the `test/unit` directory).

```bash
./scripts/tests/run_unit.sh
```

#### 2. Running Integration Tests

Integration tests validate the service layer interaction with the database (files in the `test/integration` directory). Requires the MySQL container to be running.

```bash
./scripts/tests/run_service_integration.sh
```
```bash
./scripts/tests/run_api_integration.sh
```

#### 3. Test Visualization (Advanced)

Generate a visualization graph of the integration test dependencies using the `vgt` and `vizb` tools.

```bash
./scripts/tests/vis_integration.sh
```

#### 4. Code Coverage

Generate a code coverage report and open it in your browser to identify untested areas.

```bash
./scripts/code_coverage.sh
```

### Documentation and Development Utilities

#### 1. Generate Swagger (OpenAPI) Documentation

Update the JSON/YAML files that power the live Swagger UI.

```bash
swag init -g cmd/api/main.go
```

#### 2. View Live Godoc Documentation

View the standard Go documentation generated by scanning your code comments.

```bash
godoc -http=:6060
```
Access the docs in your browser: `http://localhost:6060/pkg/github.com/TIA-PARTNERS-GROUP/tia-api/`

#### 3. Generate Markdown Documentation

Use `gomarkdoc` to generate documentation for specific packages and structures directly into Markdown files (e.g., for placement in a `docs/` folder).

```bash
# Example: Generate docs for a core service package
gomarkdoc ./internal/core/services -o docs/services.md
```

#### 4. Benchmarking

Run performance benchmarks to measure and track critical function performance.

```bash
./scripts/benchmark.sh
```
